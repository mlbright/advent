<div class="calendar-day-edit">
  <h1>Edit Day <%= @day.day_number %> - <%= @calendar.title %></h1>
  <p class="form-help">Add an image or video with a title and description for this day.</p>

  <%= form_with model: @day, url: calendar_calendar_day_path(@calendar, @day.day_number), method: :patch, local: true do |form| %>
    <% if @day.errors.any? %>
      <div class="alert alert-danger">
        <h3><%= @day.errors.count %> <%= @day.errors.count == 1 ? 'error' : 'errors' %> prohibited this day from being saved:</h3>
        <ul>
          <% @day.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="form-group">
      <%= form.label :title, "Title (optional)" %>
      <%= form.text_field :title, class: "form-control", placeholder: "A special surprise for you..." %>
    </div>

    <div class="form-group">
      <%= form.label :content_type, "Content Type" %>
      <%= form.select :content_type, 
          [['Image', 'image'], ['Video', 'video']], 
          { include_blank: 'Select type...' }, 
          { class: "form-control", required: true } %>
    </div>

    <div class="form-group">
      <%= form.label :url, "URL" %>
      <%= form.url_field :url, class: "form-control", 
          placeholder: "https://youtube.com/watch?v=... or https://example.com/image.jpg",
          required: true %>
      <small class="form-text">Supported: YouTube, Vimeo videos, and image URLs (JPG, PNG, GIF, WEBP)</small>
    </div>

    <div class="form-group">
      <%= form.label :description, "Description" %>
      <%= form.text_area :description, rows: 6, class: "form-control", 
          placeholder: "Write a message to go with this content..." %>
    </div>

    <div class="form-actions">
      <%= form.submit "Save Day Content", class: "btn btn-primary" %>
      <% if @day.has_content? %>
        <%= link_to "Preview Day", calendar_calendar_day_path(@calendar, @day.day_number), class: "btn btn-secondary" %>
      <% end %>
      <%= link_to "Back to Calendar", calendar_path(@calendar), class: "btn btn-secondary" %>
    </div>
  <% end %>

  <% if @day.has_content? %>
    <div class="current-content">
      <h3>Current Content Preview</h3>
      <div class="content-preview">
        <% if @day.content_type == 'image' %>
          <%= UrlEmbedder.embed(@day.url, 'image') %>
        <% elsif @day.content_type == 'video' %>
          <%= UrlEmbedder.embed(@day.url, 'video') %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
